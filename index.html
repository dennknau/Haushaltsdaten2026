<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Interaktive Haushaltsdaten</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h1>Haushaltsdaten</h1>

<label>Bitte Gruppe auswählen:</label>
<select id="gruppenFilter"></select>

<canvas id="chart1" width="400" height="200"></canvas>

<script>
async function loadData() {
    // JSON-Datei laden (liegt gleich neben index.html)
    const response = await fetch('haushalt.json');
    const data = await response.json();
    return data;
}

loadData().then(data => {
    // 1. Alle Gruppen sammeln
    const gruppen = [...new Set(data.map(d => d.gruppe))];

    const select = document.getElementById('gruppenFilter');
    gruppen.forEach(g => {
        const opt = document.createElement('option');
        opt.value = g;
        opt.textContent = g;
        select.appendChild(opt);
    });

    // 2. Standard-Anzeige
    drawChartFor(gruppen[0], data);

    // 3. Beim Wechsel: neu zeichnen
    select.addEventListener('change', () => {
        drawChartFor(select.value, data);
    });
});

function drawChartFor(gruppe, data) {
    const ctx = document.getElementById('chart1').getContext('2d');

    const filtered = data.filter(d => d.gruppe === gruppe);

    const labels = filtered.map(d => d.sachkonto);
    const values = filtered.map(d => d.betrag);

    if (window.myChart) {
        window.myChart.destroy();
    }

    window.myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '€ nach HH',
                data: values
            }]
        }
    });
}
</script>

</body>
</html>
